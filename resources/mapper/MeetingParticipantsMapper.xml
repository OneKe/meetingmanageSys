<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.chinasofti.mms.dao.MeetingParticipantsMapper">
	<resultMap id="BaseResultMap" type="com.chinasofti.mms.pojo.MeetingParticipants">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon Jul 17 
			14:35:17 CST 2017. -->
		<id column="mpId" property="mpid" jdbcType="INTEGER" />
		<result column="MeetingId" property="meetingid" jdbcType="INTEGER" />
		<result column="ParticipantId" property="participantid"
			jdbcType="INTEGER" />
	</resultMap>
	<sql id="Base_Column_List">
		mpId, MeetingId, ParticipantId
	</sql>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		select
		<include refid="Base_Column_List" />
		from meetingparticipants
		where mpId = #{mpid,jdbcType=INTEGER}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		delete from meetingparticipants
		where mpId = #{mpid,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.chinasofti.mms.pojo.MeetingParticipants">
		insert into meetingparticipants (mpId, MeetingId, ParticipantId
		)
		values (#{mpid,jdbcType=INTEGER}, #{meetingid,jdbcType=INTEGER},
		#{participantid,jdbcType=INTEGER}
		)
	</insert>
	<insert id="insertSelective" parameterType="com.chinasofti.mms.pojo.MeetingParticipants">
		insert into meetingparticipants
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="mpid != null">
				mpId,
			</if>
			<if test="meetingid != null">
				MeetingId,
			</if>
			<if test="participantid != null">
				ParticipantId,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="mpid != null">
				#{mpid,jdbcType=INTEGER},
			</if>
			<if test="meetingid != null">
				#{meetingid,jdbcType=INTEGER},
			</if>
			<if test="participantid != null">
				#{participantid,jdbcType=INTEGER},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.chinasofti.mms.pojo.MeetingParticipants">
		update meetingparticipants
		<set>
			<if test="meetingid != null">
				MeetingId = #{meetingid,jdbcType=INTEGER},
			</if>
			<if test="participantid != null">
				ParticipantId = #{participantid,jdbcType=INTEGER},
			</if>
		</set>
		where mpId = #{mpid,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.chinasofti.mms.pojo.MeetingParticipants">
		update meetingparticipants
		set MeetingId = #{meetingid,jdbcType=INTEGER},
		ParticipantId = #{participantid,jdbcType=INTEGER}
		where mpId = #{mpid,jdbcType=INTEGER}
	</update>

	<!-- 查询我的预定会议，通过用户名ID -->
	<select id="selectByEmployeeName" parameterType="String"
		resultType="Map">
		SELECT
		m.Meetingid,m.MeetingName,mr.RoomName,m.BeginTime,m.EndTime,m.ReservationTime
		FROM meeting m,meetingroom mr
		WHERE m.RoomId=mr.RoomId AND reservationistID=#{id} and meetingstatus=1
	</select>

	<!-- 用户登录 -->
	<select id="findlogin" parameterType="Employee" resultType="Employee">
		select * from employee where username=#{username} and
		userpwd=#{userpwd};
	</select>


	<!-- 最新通知中，未来7天我要参加的会议: -->
	<select id="selectMeetingByOrder" resultType="Map">
		select m.MeetingId,m.MeetingName,mr.RoomName,m.BeginTime,m.EndTime from
		meeting m,meetingparticipants mp,meetingroom mr
		where m.RoomId=mr.RoomId and m.MeetingId=mp.MeetingId AND
		mp.ParticipantId=#{id} and meetingstatus=1 and begintime &lt;
		DATE_SUB(NOW(),INTERVAL -7 DAY) and BeginTime >=NOW()
	</select>

	<!-- 在最新通知里显示：已取消的会议 -->
	<select id="cancelMeetingMap" resultType="Map">
		select
		m.MeetingId,m.MeetingName,mr.RoomName,m.BeginTime,m.EndTime,m.CanceledReson
		from meeting m,meetingroom mr
		where m.RoomId=mr.RoomId and m.meetingstatus=2
	</select>

	<!-- 修改密码 -->
	<update id="updateNewPassword">
		update employee set userpwd =#{2} where username=#{0} and userpwd=#{1}
	</update>

	<!-- 通过会议id，查询会议详情 -->
	<select id="selectByMyMeetingById" resultType="Meeting">
		select * from meeting where meetingid=#{0}
	</select>

	<!-- 通过会议id，查询参加该会议的所有员工 -->
	<select id="selectEmployeeByMeetingId" resultType="Employee">
		select Employeename,Phone,Email from employee
		where EmployeeId in(select ParticipantId from meetingparticipants WHERE
		meetingid=#{0})
	</select>

	<!-- **************人员管理： 搜索员工 ************ -->
	<select id="findEmployee" parameterType="Map" resultType="Employee">
		select * from Employee
		where EmployeeName like '%${employeeName}%' and UserName like
		'%${accountName}%' and EmployeeStatus = #{intStatus} limit #{page.startRow},#{page.pageSize}
	</select>

	<!-- **************人员管理：搜索员工********关闭账号************ -->
	<update id="updateEmployeeStatus">
		update Employee set EmployeeStatus =#{1} where EmployeeId =#{0}
	</update>

	<!-- 个人中心 > 最新通知 > 撤销会议 -->
	<update id="cancelOneMeeting">
		update Meeting set MeetingStatus =2 , canceledreson=#{1} ,canceledtime=Now()
		where meetingid=#{0}
	</update>

	<!-- 批量添加 -->
	<insert id="insertMpt">
		INSERT INTO meetingparticipants(mpid,meetingid,ParticipantId) VALUES
		<foreach collection="list" item="mpt" index="index" separator=",">
			(#{mpt.mpid},#{mpt.meetingid},#{mpt.participantid})
		</foreach>
	</insert>
	
	<!-- ************会议预定 > 查看所有会议室*************** -->
	<select id="selectAllMeetingRoom" resultType="Map">
	select RoomId,RoomCode,RoomName,RoomCapacity,RoomStatus,Description from MeetingRoom
	</select>
	
	<!-- **********会议预定 > 查看所有会议室 > 会议室详情***** -->
	<select id="selectOneMeetingRoom" resultType="MeetingRoom">
	select * from meetingroom where RoomId = #{0}
	</select>
	
	<!-- 会议预定 > 查看所有会议室 > 会议室详情 > 确认修改会议室信息 -->
	<update id="updateMeetingRoom" parameterType="MeetingRoom">
	update meetingroom set RoomCode=#{roomcode},RoomName=#{roomname},RoomCapacity=#{roomcapacity},RoomStatus=#{roomstatus},Description=#{description}
	where RoomId =#{roomid}
	</update>
	
	<!-- 根据员工状态查出所有员工的个数，为分页准备 -->
	<select id="findUserList" resultType="Employee">
	select * from employee where EmployeeStatus=#{0}
	
	</select>
	<!-- 按照页面的条件不分页，查出符合条件的总条数 -->
	<select id="searchTotalCount" resultType="java.lang.Integer">
	select count(*) from employee where EmployeeName like '%${0}%' and UserName like
		'%${1}%' and EmployeeStatus=#{2}
	</select>
</mapper>